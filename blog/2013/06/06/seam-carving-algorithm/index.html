
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Seam carving algorithm - K. Lykov Blog</title>
  <meta name="author" content="Kirill Lykov">

  
  <meta name="description" content="Intro Seam carving is an algorithm for content-aware image resizing, it was described in the paper by S. Avidan &amp; A. Shamir. In contract to &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://KirillLykov.github.com/blog/2013/06/06/seam-carving-algorithm/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="K. Lykov Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">K. Lykov Blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:KirillLykov.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Seam Carving Algorithm</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-06T22:41:00+02:00" pubdate data-updated="true">Jun 6<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Intro</h2>

<p>Seam carving is an algorithm for content-aware image resizing, it was described in the paper by <a href="http://www.win.tue.nl/~wstahw/2IV05/seamcarving.pdf">S. Avidan &amp; A. Shamir</a>. In contract to stretching, content-aware resizing
allows to remove/add pixels which has less meaning while saving more important. Pictures below demonstrate this - original picture of the size 332x480 is on the top, the picture after applying seam carving (size is 272x400) is on the bottom</p>

<center>
<img src="../../../../../images/seamcarving/sea-thai.jpg">
<img src="../../../../../images/seamcarving/sea-thai-reduced.jpg">
</center>


<p>This algorithm is quite impressive so one may find a lot of articles describing it. Yet as I found most of the authors haven&#8217;t read the original paper and provide a very basic implementation. In this post I will describe the algorithm with all details as it was written by Avidan &amp; Shamir. Yet I will write from the programmers point of view, without going into Math too deep. In addition to algorithms description, I also provide Matlab code.</p>

<!--more-->


<h2>Energy</h2>

<p>For simplification, we will describe only reducing the size of the image. But enlarging process is very similar and described in the last section.
The idea is to remove content that has smaller meaning for the user (contain less information). We will call this information &#8220;energy&#8221;. Thus we need to introduce an energy function that would map a pixel into
energy value. For instance, we can use gradient of the pixel: <img src="http://latex.codecogs.com/gif.latex?e_1= \left|\frac{\partial I}{\partial x}\right| + \left|\frac{\partial I}{\partial y}\right|" style="border: none; box-shadow: none;vertical-align:middle"/>. If a picture has 3 channels, just sum values of the energy in each channel. The Matlab code below demostates it. The <code>imfilter</code> function just applies the mask to each pixel, so the result dI(i, j)/dx = I(i+1)-I(i-1)/dx where dx = 1.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='matlab'><span class='line'><span class="k">function</span><span class="w"> </span>res <span class="p">=</span><span class="w"> </span><span class="nf">energyRGB</span><span class="p">(</span>I<span class="p">)</span><span class="w"></span>
</span><span class='line'><span class="c">% returns energy of all pixelels</span>
</span><span class='line'><span class="c">% e = |dI/dx| + |dI/dy|</span>
</span><span class='line'>    <span class="n">res</span> <span class="p">=</span> <span class="n">energyGrey</span><span class="p">(</span><span class="n">I</span><span class="p">(:,</span> <span class="p">:,</span> 1<span class="p">))</span> <span class="o">+</span> <span class="n">energyGrey</span><span class="p">(</span><span class="n">I</span><span class="p">(:,</span> <span class="p">:,</span> 2<span class="p">))</span> <span class="o">+</span> <span class="n">energyGrey</span><span class="p">(</span><span class="n">I</span><span class="p">(:,</span> <span class="p">:,</span> 3<span class="p">));</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span><span class="w"> </span>res <span class="p">=</span><span class="w"> </span><span class="nf">energyGrey</span><span class="p">(</span>I<span class="p">)</span><span class="w"></span>
</span><span class='line'><span class="c">% returns energy of all pixelels</span>
</span><span class='line'><span class="c">% e = |dI/dx| + |dI/dy|</span>
</span><span class='line'>    <span class="n">res</span> <span class="p">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">imfilter</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span>1<span class="p">,</span>0<span class="p">,</span>1<span class="p">],</span> <span class="s">&#39;replicate&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">imfilter</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span>1<span class="p">;</span>0<span class="p">;</span>1<span class="p">],</span> <span class="s">&#39;replicate&#39;</span><span class="p">));</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is energy function:</p>

<center>
<img src="../../../../../images/seamcarving/sea-thai-energy.jpg">
</center>


<h2>Seam</h2>

<p>If we delete pixels with minimum energy but random positions, we will get distorted picture. If we delete columns/rows with minimum energy, we will get artifacts. Here by column I mean {(i, j)| j is predefined}, row - {(i, j)| i is predefined}. The solution is to introduce a generalization of column/row (called <code>seam</code>). Formally, let I is n x m image, then a vertical seam is <img src="http://latex.codecogs.com/gif.latex?(s^x)_i=(i, x(j)) s.t. \forall i, \left|x(i) - x(i-1)\right| \leq 1" style="border: none; box-shadow: none;vertical-align:middle"/>, where x: [1,..,n] -> [1,..,m]. It means that a vertical seam is path from the top of the picture to the bottom such that the length of the path in pixels is width of the image, and for each seam element (i,j),
the next seam element can be only (i+1, j-1), (i+1, j), (i+1, j+1). Similarly, we can define a horizontal seam. Examples of seams are shown on the figure below in black:</p>

<center>
<img src="../../../../../images/seamcarving/sea-thai-seams.jpg">
</center>


<p>We are looking for a seam with the minimum energy among all seams (in chosen dimension):  <img src="http://latex.codecogs.com/gif.latex?s^* = \[\min_{s} \sum_{i=1}^{n} e(I(s_i)))\]" style="border: none; box-shadow: none;vertical-align:middle"/>.
The way to find such an optimal way is by using dynamic programming:</p>

<ol>
<li>Find M - minimum energy for all possible seams for each (i, j):

<ul>
<li>fill in the first row by energy</li>
<li>for all rows starting from second:
  M[i, j] = e[i, j] + min(M[i - 1, j], M[i, j], M[i + 1, j]);</li>
</ul>
</li>
<li>Find the minimum value in the last row of M and traverse back choosing pixels with minimum energy.</li>
</ol>


<p>Note that in Matlab code I had to represent seam as n x m bit matrix. If pixel is in the seam it is 0, otherwise 1.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='matlab'><span class='line'><span class="k">function</span><span class="w"> </span>[optSeamMask, seamEnergy] <span class="p">=</span><span class="w"> </span><span class="nf">findOptSeam</span><span class="p">(</span>energy<span class="p">)</span><span class="w"></span>
</span><span class='line'><span class="c">% finds optimal seam</span>
</span><span class='line'><span class="c">% returns mask with 0 mean a pixel is in the seam</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">% find M for vertical seams</span>
</span><span class='line'>    <span class="c">% for vertical - use I`</span>
</span><span class='line'>    <span class="n">M</span> <span class="p">=</span> <span class="n">padarray</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="p">[</span>0 1<span class="p">],</span> <span class="nb">realmax</span><span class="p">(</span><span class="s">&#39;double&#39;</span><span class="p">));</span> <span class="c">% to avoid handling border elements</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">sz</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">M</span><span class="p">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> 2 <span class="p">:</span> <span class="n">sz</span><span class="p">(</span>1<span class="p">)</span>
</span><span class='line'>        <span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> 2 <span class="p">:</span> <span class="p">(</span><span class="n">sz</span><span class="p">(</span>2<span class="p">)</span> <span class="o">-</span> 1<span class="p">)</span>
</span><span class='line'>            <span class="n">neighbors</span> <span class="p">=</span> <span class="p">[</span><span class="n">M</span><span class="p">(</span><span class="nb">i</span> <span class="o">-</span> 1<span class="p">,</span> <span class="nb">j</span> <span class="o">-</span> 1<span class="p">)</span> <span class="n">M</span><span class="p">(</span><span class="nb">i</span> <span class="o">-</span> 1<span class="p">,</span> <span class="nb">j</span><span class="p">)</span> <span class="n">M</span><span class="p">(</span><span class="nb">i</span> <span class="o">-</span> 1<span class="p">,</span> <span class="nb">j</span> <span class="o">+</span> 1<span class="p">)];</span>
</span><span class='line'>            <span class="n">M</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">)</span> <span class="p">=</span> <span class="n">M</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">neighbors</span><span class="p">);</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">% find the min element in the last raw</span>
</span><span class='line'>    <span class="p">[</span><span class="n">val</span><span class="p">,</span> <span class="n">indJ</span><span class="p">]</span> <span class="p">=</span> <span class="n">min</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="n">sz</span><span class="p">(</span>1<span class="p">),</span> <span class="p">:));</span>
</span><span class='line'>    <span class="n">seamEnergy</span> <span class="p">=</span> <span class="n">val</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">optSeamMask</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">energy</span><span class="p">),</span> <span class="s">&#39;uint8&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">%go backward and save (i, j)</span>
</span><span class='line'>    <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="n">sz</span><span class="p">(</span>1<span class="p">)</span> <span class="p">:</span> <span class="o">-</span>1 <span class="p">:</span> 2
</span><span class='line'>        <span class="c">%optSeam(i) = indJ - 1;</span>
</span><span class='line'>        <span class="n">optSeamMask</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="n">indJ</span> <span class="o">-</span> 1<span class="p">)</span> <span class="p">=</span> 1<span class="p">;</span> <span class="c">% -1 because of padding on 1 element from left</span>
</span><span class='line'>        <span class="n">neighbors</span> <span class="p">=</span> <span class="p">[</span><span class="n">M</span><span class="p">(</span><span class="nb">i</span> <span class="o">-</span> 1<span class="p">,</span> <span class="n">indJ</span> <span class="o">-</span> 1<span class="p">)</span> <span class="n">M</span><span class="p">(</span><span class="nb">i</span> <span class="o">-</span> 1<span class="p">,</span> <span class="n">indJ</span><span class="p">)</span> <span class="n">M</span><span class="p">(</span><span class="nb">i</span> <span class="o">-</span> 1<span class="p">,</span> <span class="n">indJ</span> <span class="o">+</span> 1<span class="p">)];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">val</span><span class="p">,</span> <span class="n">indIncr</span><span class="p">]</span> <span class="p">=</span> <span class="n">min</span><span class="p">(</span><span class="n">neighbors</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">seamEnergy</span> <span class="p">=</span> <span class="n">seamEnergy</span> <span class="o">+</span> <span class="n">val</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">indJ</span> <span class="p">=</span> <span class="n">indJ</span> <span class="o">+</span> <span class="p">(</span><span class="n">indIncr</span> <span class="o">-</span> 2<span class="p">);</span> <span class="c">% (x - 2): [1,2]-&gt;[-1,1]]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">optSeamMask</span><span class="p">(</span>1<span class="p">,</span> <span class="n">indJ</span> <span class="o">-</span> 1<span class="p">)</span> <span class="p">=</span> 1<span class="p">;</span> <span class="c">% -1 because of padding on 1 element from left</span>
</span><span class='line'>    <span class="n">optSeamMask</span> <span class="p">=</span> <span class="o">~</span><span class="n">optSeamMask</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In order to find a horizontal seam, just pass a transposed energy matrix to <code>findOptSeam</code>.</p>

<h2>Find optimal order of deleting seams</h2>

<p>Now we can compute seams and using the code below we can even remove them from an image:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='matlab'><span class='line'><span class="k">function</span><span class="w"> </span>imageReduced <span class="p">=</span><span class="w"> </span><span class="nf">reduceImageByMaskVertical</span><span class="p">(</span>image, seamMask<span class="p">)</span><span class="w"></span>
</span><span class='line'><span class="w">    </span><span class="n">imageReduced</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 1<span class="p">),</span> <span class="nb">size</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 2<span class="p">)</span> <span class="o">-</span> 1<span class="p">,</span> <span class="nb">size</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 3<span class="p">));</span>
</span><span class='line'>    <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> 1 <span class="p">:</span> <span class="nb">size</span><span class="p">(</span><span class="n">seamMask</span><span class="p">,</span> 1<span class="p">)</span>
</span><span class='line'>        <span class="n">imageReduced</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="p">:,</span> 1<span class="p">)</span> <span class="p">=</span> <span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="n">seamMask</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="p">:),</span> 1<span class="p">);</span>
</span><span class='line'>        <span class="n">imageReduced</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="p">:,</span> 2<span class="p">)</span> <span class="p">=</span> <span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="n">seamMask</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="p">:),</span> 2<span class="p">);</span>
</span><span class='line'>        <span class="n">imageReduced</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="p">:,</span> 3<span class="p">)</span> <span class="p">=</span> <span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="n">seamMask</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="p">:),</span> 3<span class="p">);</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span><span class="w"> </span>imageReduced <span class="p">=</span><span class="w"> </span><span class="nf">reduceImageByMaskHorizontal</span><span class="p">(</span>image, seamMask<span class="p">)</span><span class="w"></span>
</span><span class='line'><span class="w">    </span><span class="n">imageReduced</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 1<span class="p">)</span> <span class="o">-</span> 1<span class="p">,</span> <span class="nb">size</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 2<span class="p">),</span> <span class="nb">size</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 3<span class="p">));</span>
</span><span class='line'>    <span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> 1 <span class="p">:</span> <span class="nb">size</span><span class="p">(</span><span class="n">seamMask</span><span class="p">,</span> 2<span class="p">)</span>
</span><span class='line'>        <span class="n">imageReduced</span><span class="p">(:,</span> <span class="nb">j</span><span class="p">,</span> 1<span class="p">)</span> <span class="p">=</span> <span class="n">image</span><span class="p">(</span><span class="n">seamMask</span><span class="p">(:,</span> <span class="nb">j</span><span class="p">),</span> <span class="nb">j</span><span class="p">,</span> 1<span class="p">);</span>
</span><span class='line'>        <span class="n">imageReduced</span><span class="p">(:,</span> <span class="nb">j</span><span class="p">,</span> 2<span class="p">)</span> <span class="p">=</span> <span class="n">image</span><span class="p">(</span><span class="n">seamMask</span><span class="p">(:,</span> <span class="nb">j</span><span class="p">),</span> <span class="nb">j</span><span class="p">,</span> 2<span class="p">);</span>
</span><span class='line'>        <span class="n">imageReduced</span><span class="p">(:,</span> <span class="nb">j</span><span class="p">,</span> 3<span class="p">)</span> <span class="p">=</span> <span class="n">image</span><span class="p">(</span><span class="n">seamMask</span><span class="p">(:,</span> <span class="nb">j</span><span class="p">),</span> <span class="nb">j</span><span class="p">,</span> 3<span class="p">);</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>It is already a good tool for reducing image in one dimension - just find and delete seam as many times as you need. But what if you need to reduce the
size of the image in both directions? How to decide at every iteration whether it is better (in terms of energy minimization) to delete a column or a row?
This problem is solved, again, using dynamic programming. Let n&#8217; x m&#8217; are desirable size of the image (n&#8217; &lt; n, m&#8217; &lt; m). We introduce a transport matrix T which defines for every n&#8217; x m&#8217; the cost of the optimal sequence
of horizontal and vertical seam removal operations. It is more suitable to introduce r = n - n&#8217; and c = m - m&#8217; which defines number of horizontal
and vertical removal operations. In addition to T we introduce a map of the size r x c TBM which specifies for every T(i, j) whether we came to this point using
horizontal (0) or vertical (1) seam removal operation. Pseudocode is shown below:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mi">1</span><span class="p">)</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="mi">2</span><span class="p">)</span> <span class="n">Intialize</span> <span class="n">borders</span> <span class="n">of</span> <span class="n">T</span><span class="o">:</span>
</span><span class='line'>   <span class="k">for</span> <span class="n">all</span> <span class="n">j</span> <span class="p">{</span>
</span><span class='line'>       <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">E</span><span class="p">(</span><span class="n">seamVertical</span><span class="p">);</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>   <span class="k">for</span> <span class="n">all</span> <span class="n">i</span> <span class="p">{</span>
</span><span class='line'>       <span class="n">T</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">E</span><span class="p">(</span><span class="n">seamHorizontal</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="mi">3</span><span class="p">)</span> <span class="n">Initialize</span> <span class="n">borders</span> <span class="n">of</span> <span class="n">TBM</span><span class="o">:</span>
</span><span class='line'>   <span class="k">for</span> <span class="n">all</span> <span class="n">j</span> <span class="p">{</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>   <span class="k">for</span> <span class="n">all</span> <span class="n">i</span> <span class="p">{</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="mi">4</span><span class="p">)</span> <span class="n">Fill</span> <span class="n">in</span> <span class="n">T</span> <span class="n">and</span> <span class="n">TBM</span> <span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">like</span> <span class="n">pseudocode</span><span class="p">)</span><span class="o">:</span>
</span><span class='line'>   <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">to</span> <span class="n">r</span> <span class="p">{</span>
</span><span class='line'>       <span class="n">imageWithoutRow</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
</span><span class='line'>       <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">to</span> <span class="n">c</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">energy</span> <span class="o">=</span> <span class="n">computeEnergy</span><span class="p">(</span><span class="n">imageWithoutRow</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">horizontalSeamEnergy</span> <span class="o">=</span> <span class="n">findHorizontalSeamEnergy</span><span class="p">(</span><span class="n">energy</span><span class="p">);</span>
</span><span class='line'>      <span class="n">verticalSeamEnergy</span> <span class="o">=</span> <span class="n">findVerticalSeamEnergy</span><span class="p">(</span><span class="n">energy</span><span class="p">);</span>
</span><span class='line'>      <span class="n">tVertical</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">verticalSeamEnergy</span><span class="p">;</span>
</span><span class='line'>      <span class="n">tHorizontal</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">_</span> <span class="n">horizontalSeamEnergy</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">tVertical</span> <span class="o">&lt;</span> <span class="n">tHorizontal</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">T</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">tVertical</span><span class="p">;</span>
</span><span class='line'>         <span class="n">transBitMask</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">T</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">tHorizontal</span><span class="p">;</span>    
</span><span class='line'>         <span class="n">transBitMask</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>            <span class="c1">// move from left to right - delete vertical seam</span>
</span><span class='line'>            <span class="n">imageWithoutRow</span> <span class="o">=</span> <span class="n">removeVerticalSeam</span><span class="p">(</span><span class="n">energy</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">energy</span> <span class="o">=</span> <span class="n">computeEnergy</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
</span><span class='line'>        <span class="n">image</span> <span class="o">=</span> <span class="n">removeHorizontalSeam</span><span class="p">(</span><span class="n">energy</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="mi">5</span><span class="p">)</span> <span class="n">Go</span> <span class="n">backward</span> <span class="n">starting</span> <span class="n">from</span> <span class="n">T</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="n">and</span> <span class="n">following</span> <span class="n">the</span> <span class="n">TBM</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>And Matlab imeplementation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='matlab'><span class='line'><span class="k">function</span><span class="w"> </span>[T, transBitMask] <span class="p">=</span><span class="w"> </span><span class="nf">findTransportMatrix</span><span class="p">(</span>sizeReduction, image<span class="p">)</span><span class="w"></span>
</span><span class='line'><span class="c">% find optimal order of removing raws and columns</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">T</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">sizeReduction</span><span class="p">(</span>1<span class="p">)</span> <span class="o">+</span> 1<span class="p">,</span> <span class="n">sizeReduction</span><span class="p">(</span>2<span class="p">)</span> <span class="o">+</span> 1<span class="p">,</span> <span class="s">&#39;double&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">transBitMask</span> <span class="p">=</span> <span class="nb">ones</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">T</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span>1<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">% fill in borders</span>
</span><span class='line'>    <span class="n">imageNoRow</span> <span class="p">=</span> <span class="n">image</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> 2 <span class="p">:</span> <span class="nb">size</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> 1<span class="p">)</span>
</span><span class='line'>        <span class="n">energy</span> <span class="p">=</span> <span class="n">energyRGB</span><span class="p">(</span><span class="n">imageNoRow</span><span class="p">);</span>
</span><span class='line'>        <span class="p">[</span><span class="n">optSeamMask</span><span class="p">,</span> <span class="n">seamEnergyRow</span><span class="p">]</span> <span class="p">=</span> <span class="n">findOptSeam</span><span class="p">(</span><span class="n">energy</span><span class="o">&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">imageNoRow</span> <span class="p">=</span> <span class="n">reduceImageByMask</span><span class="p">(</span><span class="n">imageNoRow</span><span class="p">,</span> <span class="n">optSeamMask</span><span class="p">,</span> 0<span class="p">);</span>
</span><span class='line'>        <span class="n">transBitMask</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> 1<span class="p">)</span> <span class="p">=</span> 0<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">T</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> 1<span class="p">)</span> <span class="p">=</span> <span class="n">T</span><span class="p">(</span><span class="nb">i</span> <span class="o">-</span> 1<span class="p">,</span> 1<span class="p">)</span> <span class="o">+</span> <span class="n">seamEnergyRow</span><span class="p">;</span>
</span><span class='line'>    <span class="k">end</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">imageNoColumn</span> <span class="p">=</span> <span class="n">image</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> 2 <span class="p">:</span> <span class="nb">size</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> 2<span class="p">)</span>
</span><span class='line'>        <span class="n">energy</span> <span class="p">=</span> <span class="n">energyRGB</span><span class="p">(</span><span class="n">imageNoColumn</span><span class="p">);</span>
</span><span class='line'>        <span class="p">[</span><span class="n">optSeamMask</span><span class="p">,</span> <span class="n">seamEnergyColumn</span><span class="p">]</span> <span class="p">=</span> <span class="n">findOptSeam</span><span class="p">(</span><span class="n">energy</span><span class="p">);</span>
</span><span class='line'>        <span class="n">imageNoColumn</span> <span class="p">=</span> <span class="n">reduceImageByMask</span><span class="p">(</span><span class="n">imageNoColumn</span><span class="p">,</span> <span class="n">optSeamMask</span><span class="p">,</span> 1<span class="p">);</span>
</span><span class='line'>        <span class="n">transBitMask</span><span class="p">(</span>1<span class="p">,</span> <span class="nb">j</span><span class="p">)</span> <span class="p">=</span> 1<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">T</span><span class="p">(</span>1<span class="p">,</span> <span class="nb">j</span><span class="p">)</span> <span class="p">=</span> <span class="n">T</span><span class="p">(</span>1<span class="p">,</span> <span class="nb">j</span> <span class="o">-</span> 1<span class="p">)</span> <span class="o">+</span> <span class="n">seamEnergyColumn</span><span class="p">;</span>
</span><span class='line'>    <span class="k">end</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">% on the borders, just remove one column and one row before proceeding</span>
</span><span class='line'>    <span class="n">energy</span> <span class="p">=</span> <span class="n">energyRGB</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
</span><span class='line'>    <span class="p">[</span><span class="n">optSeamMask</span><span class="p">,</span> <span class="n">seamEnergyRow</span><span class="p">]</span> <span class="p">=</span> <span class="n">findOptSeam</span><span class="p">(</span><span class="n">energy</span><span class="o">&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">image</span> <span class="p">=</span> <span class="n">reduceImageByMask</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">optSeamMask</span><span class="p">,</span> 0<span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">energy</span> <span class="p">=</span> <span class="n">energyRGB</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
</span><span class='line'>    <span class="p">[</span><span class="n">optSeamMask</span><span class="p">,</span> <span class="n">seamEnergyColumn</span><span class="p">]</span> <span class="p">=</span> <span class="n">findOptSeam</span><span class="p">(</span><span class="n">energy</span><span class="p">);</span>
</span><span class='line'>    <span class="n">image</span> <span class="p">=</span> <span class="n">reduceImageByMask</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">optSeamMask</span><span class="p">,</span> 1<span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">% fill in internal part</span>
</span><span class='line'>    <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> 2 <span class="p">:</span> <span class="nb">size</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> 1<span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">imageWithoutRow</span> <span class="p">=</span> <span class="n">image</span><span class="p">;</span> <span class="c">% copy for deleting columns</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> 2 <span class="p">:</span> <span class="nb">size</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> 2<span class="p">)</span>
</span><span class='line'>            <span class="n">energy</span> <span class="p">=</span> <span class="n">energyRGB</span><span class="p">(</span><span class="n">imageWithoutRow</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="p">[</span><span class="n">optSeamMaskRow</span><span class="p">,</span> <span class="n">seamEnergyRow</span><span class="p">]</span> <span class="p">=</span> <span class="n">findOptSeam</span><span class="p">(</span><span class="n">energy</span><span class="o">&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="n">imageNoRow</span> <span class="p">=</span> <span class="n">reduceImageByMask</span><span class="p">(</span><span class="n">imageWithoutRow</span><span class="p">,</span> <span class="n">optSeamMaskRow</span><span class="p">,</span> 0<span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="p">[</span><span class="n">optSeamMaskColumn</span><span class="p">,</span> <span class="n">seamEnergyColumn</span><span class="p">]</span> <span class="p">=</span> <span class="n">findOptSeam</span><span class="p">(</span><span class="n">energy</span><span class="p">);</span>
</span><span class='line'>            <span class="n">imageNoColumn</span> <span class="p">=</span> <span class="n">reduceImageByMask</span><span class="p">(</span><span class="n">imageWithoutRow</span><span class="p">,</span> <span class="n">optSeamMaskColumn</span><span class="p">,</span> 1<span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">neighbors</span> <span class="p">=</span> <span class="p">[(</span><span class="n">T</span><span class="p">(</span><span class="nb">i</span> <span class="o">-</span> 1<span class="p">,</span> <span class="nb">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">seamEnergyRow</span><span class="p">)</span> <span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span> <span class="o">-</span> 1<span class="p">)</span> <span class="o">+</span> <span class="n">seamEnergyColumn</span><span class="p">)];</span>
</span><span class='line'>            <span class="p">[</span><span class="n">val</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="p">=</span> <span class="n">min</span><span class="p">(</span><span class="n">neighbors</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">T</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">)</span> <span class="p">=</span> <span class="n">val</span><span class="p">;</span>
</span><span class='line'>            <span class="n">transBitMask</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">)</span> <span class="p">=</span> <span class="n">ind</span> <span class="o">-</span> 1<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c">% move from left to right</span>
</span><span class='line'>            <span class="n">imageWithoutRow</span> <span class="p">=</span> <span class="n">imageNoColumn</span><span class="p">;</span>
</span><span class='line'>        <span class="k">end</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">energy</span> <span class="p">=</span> <span class="n">energyRGB</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
</span><span class='line'>        <span class="p">[</span><span class="n">optSeamMaskRow</span><span class="p">,</span> <span class="n">seamEnergyRow</span><span class="p">]</span> <span class="p">=</span> <span class="n">findOptSeam</span><span class="p">(</span><span class="n">energy</span><span class="o">&#39;</span><span class="p">);</span>
</span><span class='line'>         <span class="c">% move from top to bottom</span>
</span><span class='line'>        <span class="n">image</span> <span class="p">=</span> <span class="n">reduceImageByMask</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">optSeamMaskRow</span><span class="p">,</span> 0<span class="p">);</span>
</span><span class='line'>    <span class="k">end</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Enlarging an image</h2>

<p>In order to enlarge a picture, we compute k optimal seams for deleting but then, instead of deleting, copy average between neighbors:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='matlab'><span class='line'><span class="k">function</span><span class="w"> </span>imageEnlarged <span class="p">=</span><span class="w"> </span><span class="nf">enlargeImageByMaskVertical</span><span class="p">(</span>image, seamMask<span class="p">)</span><span class="w"></span>
</span><span class='line'>
</span><span class='line'><span class="w">    </span><span class="n">avg</span> <span class="p">=</span> <span class="p">@(</span><span class="n">image</span><span class="p">,</span> <span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="p">(</span><span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="o">-</span>1<span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="o">+</span>1<span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">/</span>2<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">imageEnlarged</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 1<span class="p">),</span> <span class="nb">size</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 2<span class="p">)</span> <span class="o">+</span> 1<span class="p">,</span> <span class="nb">size</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 3<span class="p">));</span>
</span><span class='line'>    <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> 1 <span class="p">:</span> <span class="nb">size</span><span class="p">(</span><span class="n">seamMask</span><span class="p">,</span> 1<span class="p">)</span>
</span><span class='line'>        <span class="nb">j</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">seamMask</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="p">:)</span> <span class="o">~=</span> 1<span class="p">);</span>
</span><span class='line'>        <span class="n">imageEnlarged</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="p">:,</span> 1<span class="p">)</span> <span class="p">=</span> <span class="p">[</span><span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> 1<span class="p">:</span><span class="nb">j</span><span class="p">,</span> 1<span class="p">),</span> <span class="n">avg</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> 1<span class="p">),</span> <span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="o">+</span>1<span class="p">:</span><span class="k">end</span><span class="p">,</span> 1<span class="p">)];</span>
</span><span class='line'>        <span class="n">imageEnlarged</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="p">:,</span> 2<span class="p">)</span> <span class="p">=</span> <span class="p">[</span><span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> 1<span class="p">:</span><span class="nb">j</span><span class="p">,</span> 2<span class="p">),</span> <span class="n">avg</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> 2<span class="p">),</span> <span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="o">+</span>1<span class="p">:</span><span class="k">end</span><span class="p">,</span> 2<span class="p">)];</span>
</span><span class='line'>        <span class="n">imageEnlarged</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="p">:,</span> 3<span class="p">)</span> <span class="p">=</span> <span class="p">[</span><span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> 1<span class="p">:</span><span class="nb">j</span><span class="p">,</span> 3<span class="p">),</span> <span class="n">avg</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> 3<span class="p">),</span> <span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="o">+</span>1<span class="p">:</span><span class="k">end</span><span class="p">,</span> 3<span class="p">)];</span>
</span><span class='line'>    <span class="k">end</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span><span class="w"> </span>imageEnlarged <span class="p">=</span><span class="w"> </span><span class="nf">enlargeImageByMaskHorizontal</span><span class="p">(</span>image, seamMask<span class="p">)</span><span class="w"></span>
</span><span class='line'>
</span><span class='line'><span class="w">    </span><span class="n">avg</span> <span class="p">=</span> <span class="p">@(</span><span class="n">image</span><span class="p">,</span> <span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="p">(</span><span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="o">-</span>1<span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span>1<span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">/</span>2<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">imageEnlarged</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 1<span class="p">)</span> <span class="o">+</span> 1<span class="p">,</span> <span class="nb">size</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 2<span class="p">),</span> <span class="nb">size</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 3<span class="p">));</span>
</span><span class='line'>    <span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> 1 <span class="p">:</span> <span class="nb">size</span><span class="p">(</span><span class="n">seamMask</span><span class="p">,</span> 2<span class="p">)</span>
</span><span class='line'>        <span class="nb">i</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">seamMask</span><span class="p">(:,</span> <span class="nb">j</span><span class="p">)</span> <span class="o">~=</span> 1<span class="p">);</span>
</span><span class='line'>        <span class="n">imageEnlarged</span><span class="p">(:,</span> <span class="nb">j</span><span class="p">,</span> 1<span class="p">)</span> <span class="p">=</span> <span class="p">[</span><span class="n">image</span><span class="p">(</span>1<span class="p">:</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> 1<span class="p">);</span> <span class="n">avg</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> 1<span class="p">);</span> <span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span>1<span class="p">:</span><span class="k">end</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> 1<span class="p">)];</span>
</span><span class='line'>        <span class="n">imageEnlarged</span><span class="p">(:,</span> <span class="nb">j</span><span class="p">,</span> 2<span class="p">)</span> <span class="p">=</span> <span class="p">[</span><span class="n">image</span><span class="p">(</span>1<span class="p">:</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> 2<span class="p">);</span> <span class="n">avg</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> 2<span class="p">);</span> <span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span>1<span class="p">:</span><span class="k">end</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> 2<span class="p">)];</span>
</span><span class='line'>        <span class="n">imageEnlarged</span><span class="p">(:,</span> <span class="nb">j</span><span class="p">,</span> 3<span class="p">)</span> <span class="p">=</span> <span class="p">[</span><span class="n">image</span><span class="p">(</span>1<span class="p">:</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> 3<span class="p">);</span> <span class="n">avg</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> 3<span class="p">);</span> <span class="n">image</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span>1<span class="p">:</span><span class="k">end</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> 3<span class="p">)];</span>
</span><span class='line'>    <span class="k">end</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Source code</h2>

<p>The full code of the program is available <a href="https://github.com/KirillLykov/cvision-algorithms/blob/master/src/seamCarving.m">here</a>.
Seam carving is also implemented in <a href="http://www.imagemagick.org/Usage/resize/#liquid-rescale">ImageMagick</a>. So if you need a
C++ implementation, check out ImageMagick code.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Kirill Lykov</span></span>

      








  


<time datetime="2013-06-06T22:41:00+02:00" pubdate data-updated="true">Jun 6<span>th</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://KirillLykov.github.com/blog/2013/06/06/seam-carving-algorithm/" data-via="" data-counturl="http://KirillLykov.github.com/blog/2013/06/06/seam-carving-algorithm/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/04/02/level-set-openvdb-intro-1/" title="Previous Post: Level sets with OpenVDB. Quick introduction. Part 1">&laquo; Level sets with OpenVDB. Quick introduction. Part 1</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/01/17/curvature-flow-in-curvature-space/" title="Next Post: Curvature flow in curvature space">Curvature flow in curvature space &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/11/28/circulating-tumor-cells-in-microfluidics/">Circulating tumor cells in microfluidics</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/17/curvature-flow-in-curvature-space/">Curvature flow in curvature space</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/06/seam-carving-algorithm/">Seam carving algorithm</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/02/level-set-openvdb-intro-1/">Level sets with OpenVDB. Quick introduction. Part 1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/19/convert-openni-star-dot-oni-files-into-avi/">Convert OpenNI (*.oni) files into avi - oni2avi</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/KirillLykov">@KirillLykov</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'KirillLykov',
            count: 2,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/Kirill Lykov?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Kirill Lykov -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
